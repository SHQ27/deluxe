<?php

/**
 * carritoBonificacion
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    deluxebuys
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class carritoBonificacion extends BasecarritoBonificacion
{
	public function getMonto($limitarMontoMaximo = false)
	{		
		$bonificacion = $this->getBonificacion();

		$montoProductos = sessionTable::getInstance()->getMontoProductos( $this->getIdSession() );
		$carritoEnvio = carritoEnvioTable::getInstance()->getByIdSession( $this->getIdSession() );
		
		if ($carritoEnvio)
		{
			$total = $montoProductos + $carritoEnvio->getCosto();
		}
		else 
		{
			$total = $montoProductos;
		}		
		
		switch ( $bonificacion->getIdTipoDescuento() )
		{
			case tipoDescuento::FREESHIPPING:
	  			$carritoEnvio = carritoEnvioTable::getInstance()->getByIdSession( $this->getIdSession() );
	  			$montoBonificacion = $carritoEnvio->getCosto(); 
	  			$esFreeShipping = true;
	  			break;
	  			
			case tipoDescuento::MONTOFIJO:
	  			$montoBonificacion = $bonificacion->getValor();
	  			break;
	  			
			case tipoDescuento::PORCENTAJE:

	  			$montoBonificacion = $montoProductos * ( $bonificacion->getValor() / 100 ); 
	  			break;
		}
		
  		if ($limitarMontoMaximo && $montoBonificacion > $total)
  		{
  			$montoBonificacion = $total;
  		}
  		
  		return $montoBonificacion;
	}
}
