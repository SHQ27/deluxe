<?php
/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class Version279 extends Doctrine_Migration_Base
{
    public function up()
    {
        $q = Doctrine_Manager::getInstance()->getCurrentConnection();
        $pedidos = $q->createQuery('p')
                     ->from('pedido p')
                     ->addWhere('p.fecha_pago is null')
                     ->addWhere('p.fecha_baja is null')
                     ->execute();
        
        
        foreach( $pedidos as $pedido )
        {
            $pedido->setFechaLimitePago( $pedido->getFechaLimiteExtendida() );
            $pedido->save();
        }
        
        $q->execute("update pedido set fecha_baja = now() where fecha_limite_pago is not null and fecha_limite_pago < now();");
    }

    public function down()
    {
    }
}