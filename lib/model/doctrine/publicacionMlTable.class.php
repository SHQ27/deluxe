<?php

/**
 * publicacionMlTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class publicacionMlTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object publicacionMlTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('publicacionMl');
    }
    
    /**
     * Retorna todos las publicacionesML que coinciden con los ids pasados por parametro
     *
     * @return Doctrine_Collection
     */
    public function listByIdProductos($idProductos)
    {
        return $this->createQuery('pml')
                    ->addWhere('pml.id_producto IN ?', array( $idProductos ) )
                    ->execute();
    }    
    
    /**
     * Retorna la cantidad de publicaciones que estan erroneamente activas en ML, ya que
     * en Deluxebuys figuran como no vigentes 
     *
     * @return int
     */
    public function countActivasErroneamenteEnML()
    {
        return $this->createQuery('pml')
        ->addWhere('pml.status_ml IS NOT NULL')
        ->addWhere('(pml.status_ml <> ?)', publicacionMl::STATUS_CLOSED)
        ->addWhere('(pml.fecha_inicio IS NULL OR pml.fecha_fin IS NULL OR ( pml.fecha_inicio > NOW() OR pml.fecha_fin < NOW() ) )')
        ->count();
    }

    /**
    * Elimina todos los productoLogs asociados a un producto
    * 
    * @param integer $idProducto
    * 
    */
    public function deleteByIdProducto( $idProducto )
    {
        $this->createQuery('pml')
                    ->delete()
                    ->addWhere('pml.id_producto= ?', array( $idProducto ) )
                    ->execute();
    }
}