<?php

/**
 * configuracion
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    deluxebuys
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class configuracion extends Baseconfiguracion
{
    const MONTO_INVITACION = 'MONTI';
    const VENCIMIENTO_INVITACION = 'VENTI';
    const MONTO_ALTA_USUARIO = 'MONTA';
    const VENCIMIENTO_ALTA_USUARIO = 'VENTA';
    const OUTLET = 'OUTLE';
    const MOSTRAR_CHAT = 'MCHAT';
    const HOME_BANNER_PIE = 'HBPIE';
    const BANNER_HEADER = 'BHEAD';
    const CARRITO_PAGO_MERCADO_PAGO = 'CAPMP';
    const CARRITO_PAGO_QUIERO_VISA = 'CAPQV';
    const CARRITO_PAGO_QUIERO_AMEX = 'CAPQA';
    const CARRITO_PAGO_HCBC_VISA = 'CAPHV';
    const CARRITO_PAGO_HCBC_AMEX = 'CAPHA';
    const CARRITO_PAGO_CITI_VISA = 'CAPCV';
    const FICHA_MEDIOS_DE_PAGO = 'FIPAG';
    const MONTO_FREE_SHIPPING = 'MONFS';
    const HORAS_ESPERA_ENVIO_ORDEN_COMPRA = 'HEODM';
    
    const TIPO_TEXTO = 'TEXTO';
    const TIPO_OULET = 'OULE';
    const TIPO_BOOLEAN = 'BOOL';
    const TIPO_IMAGEN = 'IMAGE';

    static protected $valores = array();

    static public function __callStatic($method, $params)
    {
        if (isset(static::$valores[$method])) {
            return static::$valores[$method];
        }
        $id = constant(get_class(new self) . '::' . $method);
        $valor = configuracionTable::getInstance()->getValor($id);
        static::$valores[$method] = $valor;
        return $valor;
    }
    
    public function preSave($event)   { $this->clearCache($event); }
    
    public function preDelete($event) { $this->clearCache($event); }
    
    public function clearCache($event)
    {
        if ( $this->getIdConfiguracion() == self::OUTLET )
        {
            cacheHelper::getInstance()->delete('configuracion_getOutlet');
            cacheHelper::getInstance()->deleteByPrefix('outlet_cacheClearInicioFin');
            cacheHelper::getInstance()->deleteByPrefix('outlet_a_desactivar');   
        }
        
        cacheHelper::getInstance()->delete('configuracion_getById_' . $this->getIdConfiguracion() );        
    }
    
    public function getPath()
    {
        return sfConfig::get('app_upload_dir') . '/configuracion/' . $this->getIdConfiguracion() . '.jpg';
    }
    
    public function getImage()
    {
        return sfConfig::get('app_upload_url') . '/configuracion/' . $this->getIdConfiguracion() . '.jpg?v=' . cacheHelper::getInstance()->getStaticVersion();
    }
}